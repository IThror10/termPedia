import dbTasks.*


var dir = "$rootDir/modules/DB/src/main/sql/"

// Downloading drivers
task downloadPostgresDriver(type: DownloadDriver) {
    buildDrivers = configurations.driver
    driverName = postgresDriver
}


// Command DB Tasks
task createPostgresCommandDB(type: CreatePostgresDB, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    DBName = commandDBName
}

task initPostgresCommandDB(type: ExecutePostgresScripts, dependsOn: createPostgresCommandDB) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = commandDBName

    inputDir = dir + "commandDB"
    inputFiles = ["postgresInit.sql", "postgresFunctions.sql", "postgresRoles.sql", "testInsert.sql"]
}

task dropPostgresCommandDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = null

    inputDir = dir + "commandDB"
    inputFiles = ["postgresDrop.sql"]
}

// Test Command DB Tasks
task createTestPostgresCommandDB(type: CreatePostgresDB, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    DBName = "Test" + commandDBName
}

task initTestPostgresCommandDB(type: ExecutePostgresScripts, dependsOn: createTestPostgresCommandDB) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = "Test" + commandDBName

    inputDir = dir + "commandDB"
    inputFiles = ["postgresInit.sql", "postgresFunctions.sql", "postgresTestRoles.sql", "testInsert.sql"]
}

task truncateTestPostgresCommandDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = "Test" + commandDBName

    inputDir = dir + "commandDB"
    inputFiles = ["postgresClear.sql", "testInsert.sql"]
}

task dropTestPostgresCommandDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = null

    inputDir = dir + "commandDB"
    inputFiles = ["postgresTestDrop.sql"]
}

// Query DB Tasks
task createPostgresQueryDB(type: CreatePostgresDB, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    DBName = queryDBName
}

task initPostgresQueryDB(type: ExecutePostgresScripts, dependsOn: createPostgresQueryDB) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    dataBase = queryDBName
    inputDir = dir + "queryDB"
    inputFiles = ["postgresInit.sql", "postgresFunctions.sql", "postgresProcedures.sql",
                  "postgresRoles.sql"]
}

task dropPostgresQueryDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = null

    inputDir = dir + "queryDB"
    inputFiles = ["postgresDrop.sql"]
}

// Test Query DB Tasks
task createTestPostgresQueryDB(type: CreatePostgresDB, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    DBName = "Test" + queryDBName
}

task initTestPostgresQueryDB(type: ExecutePostgresScripts, dependsOn: createTestPostgresQueryDB) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver

    dataBase = "Test" + queryDBName
    inputDir = dir + "queryDB"
    inputFiles = ["postgresInit.sql", "postgresFunctions.sql", "postgresProcedures.sql",
                  "postgresTestRoles.sql", "postgresTestInsert.sql"]
}

task truncateTestPostgresQueryDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = "Test" + queryDBName

    inputDir = dir + "queryDB"
    inputFiles = ["postgresClear.sql", "postgresTestInsert.sql"]
}

task dropTestPostgresQueryDB(type: ExecutePostgresScripts, dependsOn: downloadPostgresDriver) {
    url = postgresUrl
    username = postgresUsername
    password = postgresPassword
    driver = postgresDriver
    dataBase = null

    inputDir = dir + "queryDB"
    inputFiles = ["postgresTestDrop.sql"]
}